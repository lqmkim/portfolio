---
import ShipsLayout from "@layouts/ships-layout.astro";
import { ScrollProgress } from "@components/misc";
import { getReadingTime } from "@utils/index";
import { fetchShipBySlug } from "@utils/sanity";
import EndCTA from "@components/cta/end-cta.astro";
import { portableTextToHtml } from "@utils/portableTextToHtml";

const { slug } = Astro.params;
const ship = await fetchShipBySlug(slug as string);

if (!ship) return Astro.redirect("/404");

const readingTime = getReadingTime(ship.description);
const blocks = ship.content ?? [];
---

<ShipsLayout {...ship} readingTime={readingTime}>
  {
    blocks.map((block: any, i: number) => {
      if (block._type === "endCTA") return <EndCTA {...block} />;
      return <div set:html={portableTextToHtml([block])} />;
    })
  }
  <ScrollProgress />
</ShipsLayout>
